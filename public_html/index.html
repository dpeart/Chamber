<?php
include_once 'insert_mysql.php';
include_once 'select_mysql.php';
include_once 'home.php';
include_once 'batch.php';
?>
<html>
  <head>
   	<link rel="stylesheet" type="text/css" href="http://www.jeasyui.com/easyui/themes/default/easyui.css">
	<link rel="stylesheet" type="text/css" href="http://www.jeasyui.com/easyui/themes/icon.css">
	<link rel="stylesheet" type="text/css" href="http://www.jeasyui.com/easyui/demo/demo.css">
    <link rel='stylesheet' type='text/css' href='styles.css'>
    <link rel="stylesheet" href="http://code.jquery.com/ui/1.10.2/themes/smoothness/jquery-ui.css" />
    <script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.0/jquery.min.js"></script>
    <script src="http://code.jquery.com/ui/1.10.2/jquery-ui.js"></script>
    <script src="http://www.flotcharts.org/flot/jquery.flot.js"></script>
    <script src="http://www.flotcharts.org/flot/jquery.flot.crosshair.js"></script>
    <script src="http://www.flotcharts.org/flot/jquery.flot.time.js"></script>
    <script src="http://www.flotcharts.org/flot/jquery.flot.selection.js"></script>
    <script src="select_batch.js"></script>


	<script type="text/javascript" src="http://www.jeasyui.com/easyui/jquery.easyui.min.js"></script>
    
    <script type="text/javascript">    
      var overview, chart, options, overviewoptions;
      var currentBatch;
      var url;     
      
      $(document).ready(function() {
        // Tabs
        $("#tabs").tabs({
          beforeLoad: selectBatchInit()
        });   
      });     

      function itemNew(){
        $('#dlg').dialog('open').dialog('setTitle','New Item');
        $('#fm').form('clear');
        $('#fm').form('load',{
            idBatch:currentBatch
        });
        url = 'itemNew.php';
      }
      function itemEdit(){
        var row = $('#dg').datagrid('getSelected');
        if (row){
          $('#dlg').dialog('open').dialog('setTitle','Edit Item');
          $('#fm').form('load',row);
          url = 'itemEdit.php?id='+row.idMeat;
        }
      }
      function itemSave(){
        $('#fm').form('submit',{
          url: url,
          onSubmit: function(){
            return $(this).form('validate');
          },
          success: function(result){
            var result = eval('('+result+')');
            if (result.success){
              $('#dlg').dialog('close');		// close the dialog
              $('#dg').datagrid('reload');	// reload the user data
            } else {
              $.messager.show({
                title: 'Error',
                msg: result.msg
              });
            }
          }
        });
      }
      function itemRemove(){
        var row = $('#dg').datagrid('getSelected');
        if (row){
          $.messager.confirm('Confirm','Are you sure you want to remove this user?',function(r){
            if (r){
              $.post('itemRemove.php', {id: row.idMeat}, function(result) {
              if (result.success) {
                $('#dg').datagrid('reload');	// reload the user data
              } else {
                $.messager.show({// show error message
                  title: 'Error',
                  msg: result.msg
                });
              }
              }, 'json');
            }
          });
        }
      }
      
      function getBatch() {
        currentBatch = $('select#selectBatchName').val();
        $('#dg').datagrid({
          url:'itemGet.php?idBatch='+currentBatch 
        });
        $('#dg').datagrid('reload');	// reload the user data
      }
    </script>

  </head>
  <body>
    <div class="easyui-tabs" id="tabs">
         
      <div Title= "Home">
        <div class="demo-container">
          <div id="current_graph" class="demo-placeholder"></div>
          <div id="overview_graph" class="overview-placeholder"></div>
        </div>
        <?php
        $home = home();
        echo $home;
        $start = 1365388734;
        $stop = 1365506734;
        $type = 'Internal Temperature';
        $dataset = getReadings($start, $stop, $type);
        $type = 'Internal Humidity';
        $dataset1 = getReadings($start, $stop, $type);
        ?>
      </div>

      <div title="Admin">
        <form>
          <input type = "text" id = "createBatchName">
          <input type="button" value="Create Batch" onClick="createBatch();">
        </form>
        <div id="batch_output"></div>
        
        <form> 
          <select id="selectBatchName"></select>
          <input type="button" value="Select" onClick="getBatch();">
          <input type="button" value="Delete" onClick="deleteBatch();">
        </form>
        <div id="selectBatch_output"></div>
        
        <table id="dg" class="easyui-datagrid" style="width:700px;height:250px"
                toolbar="#toolbar" pagination="true" idField="idMeat"
                rownumbers="true" fitColumns="true" singleSelect="true">
            <thead>
                <tr>
                    <th field="idMeat" width="15" hidden="true">ID</th>
                    <th field="idBatch" width="15" hidden='true'>Batch</th>
                    <th field="Name" width="50">Name</th>
                    <th field="Recipe" width="50">Recipe</th>
                    <th field="Culture" width="50">Culture</th>
                    <th field="Mold" width="50">Mold</th>
                </tr>
            </thead>
        </table>

        <div id="toolbar">
            <a href="#" class="easyui-linkbutton" iconCls="icon-add" plain="true" onclick="itemNew()">New Item</a>
            <a href="#" class="easyui-linkbutton" iconCls="icon-edit" plain="true" onclick="itemEdit()">Edit Item</a>
            <a href="#" class="easyui-linkbutton" iconCls="icon-remove" plain="true" onclick="itemRemove()">Remove Item</a>
        </div>

        <div id="dlg" class="easyui-dialog" style="width:400px;height:280px;padding:10px 20px"
                closed="true" buttons="#dlg-buttons">
            <div class="ftitle">Item Information</div>
            <form id="fm" method="post" novalidate>
              <div class="fitem">
                <label>Batch:</label>
                <input name="idBatch">
              </div>
              <div class="fitem">
                  <label>Name:</label>
                  <input name="Name" class="easyui-validatebox" required="true">
              </div>
              <div class="fitem">
                  <label>Recipe:</label>
                  <input name="Recipe">
              </div>
              <div class="fitem">
                  <label>Culture:</label>
                  <input name="Culture">
              </div>
              <div class="fitem">
                  <label>Mold:</label>
                  <input name="Mold">
              </div>
            </form>
        </div>
        <div id="dlg-buttons">
            <a href="#" class="easyui-linkbutton" iconCls="icon-ok" onclick="itemSave()">Save</a>
            <a href="#" class="easyui-linkbutton" iconCls="icon-cancel" onclick="javascript:$('#dlg').dialog('close')">Cancel</a>
        </div>
      </div>
    
      <div title="Debug"></div>
    </div>
  </body>
</html>