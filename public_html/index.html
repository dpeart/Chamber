<?php
include_once 'insert_mysql.php';
include_once 'select_mysql.php';
include_once 'home.php';
include_once 'batch.php';
?>
<html>
  <head>
   	<link rel="stylesheet" type="text/css" href="http://www.jeasyui.com/easyui/themes/default/easyui.css">
	<link rel="stylesheet" type="text/css" href="http://www.jeasyui.com/easyui/themes/icon.css">
	<link rel="stylesheet" type="text/css" href="http://www.jeasyui.com/easyui/demo/demo.css">
    <link rel='stylesheet' type='text/css' href='styles.css'>
    <link rel="stylesheet" href="http://code.jquery.com/ui/1.10.2/themes/smoothness/jquery-ui.css" />
    <script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.0/jquery.min.js"></script>
    <script src="http://code.jquery.com/ui/1.10.2/jquery-ui.js"></script>
    <script src="http://www.flotcharts.org/flot/jquery.flot.js"></script>
    <script src="http://www.flotcharts.org/flot/jquery.flot.crosshair.js"></script>
    <script src="http://www.flotcharts.org/flot/jquery.flot.time.js"></script>
    <script src="http://www.flotcharts.org/flot/jquery.flot.selection.js"></script>
    <script src="select_batch.js"></script>
    <script type="text/javascript" src="http://www.jeasyui.com/easyui/jquery.easyui.min.js"></script>
	<script type="text/javascript" src="http://www.jeasyui.com/easyui/jquery.edatagrid.js"></script>
	 
    <script type="text/javascript">    
      var overview, chart, options, overviewoptions;
      var currentBatch;
      var url;     
      
      $(document).ready(function() {
        // Tabs
        
        $('#dgBatch').datagrid({
          onClickRow:function(rowIndex,row){
            currentBatch = row.idBatch;
            $('#dgItem').edatagrid({
              url:'itemGet.php?idBatch='+row.idBatch 
            });
            $('#dgItem').edatagrid('reload');	// reload the user data
          }
        });
        
        $('#dgItem').edatagrid({
          url: 'itemGet.php?idBatch='+currentBatch,
          saveUrl: 'itemNew.php',
          updateUrl: 'itemEdit.php',
          destroyUrl: 'itemRemove.php'
        });
        
        $('#dgStatus').edatagrid({
          url: 'statusGet.php',
          updateUrl: 'statusEdit.php'
        });
      });    

  /*    function itemNew(){
        $('#dgItem').edatagrid('addRow');
        $('#dgItem').edatagrid('addRow',{row:{idBatch:currentBatch}});
        
        $('#dlgItem').dialog('open').dialog('setTitle','New Item');
        $('#fmItem').form('clear');
        $('#fmItem').form('load',{
            idBatch:currentBatch
        });
        url = 'itemNew.php';
      }
      
      function itemEdit(){
        var row = $('#dgItem').datagrid('getSelected');
        if (row){
          $('#dlgItem').dialog('open').dialog('setTitle','Edit Item');
          $('#fmItem').form('load',row);
          url = 'itemEdit.php?id='+row.idMeat;
        }
      }
      
      function itemSave(){
        $('#fmItem').form('submit',{
          url: url,
          onSubmit: function(){
            return $(this).form('validate');
          },
          success: function(result){
            var result = eval('('+result+')');
            if (result.success){
              $('#dlgItem').dialog('close');		// close the dialog
              $('#dgItem').datagrid('reload');	// reload the user data
            } else {
              $.messager.show({
                title: 'Error',
                msg: result.msg
              });
            }
          }
        });
      }
      
      function itemRemove(){
        var row = $('#dgItem').datagrid('getSelected');
        if (row){
          $.messager.confirm('Confirm','Are you sure you want to remove this user?',function(r){
            if (r){
              $.post('itemRemove.php', {id: row.idMeat}, function(result) {
              if (result.success) {
                $('#dgItem').datagrid('reload');	// reload the user data
              } else {
                $.messager.show({// show error message
                  title: 'Error',
                  msg: result.msg
                });
              }
              }, 'json');
            }
          });
        }
      }
      
      function itemGet() {
        currentBatch = $('select#selectBatchName').val();
        $('#dgItem').datagrid({
          url:'itemGet.php?idBatch='+currentBatch 
        });
        $('#dgItem').datagrid('reload');	// reload the user data
      }
      
      function batchCreate() {
        $('#dlgBatch').dialog('open').dialog('setTitle','New Batch');
        $('#fmItem').form('clear');

        url = 'batchNew.php';
      }
*/      
      function batchRemove(){
        var row = $('#dgBatch').datagrid('getSelected');
        if (row){
          $.messager.confirm('Confirm','Are you sure you want to remove this user?',function(r){
            if (r){
              $.post('batchRemove.php', {id: row.idBatch}, function(result) {
              if (result.success) {
                $('#dgBatch').datagrid('reload');	// reload the user data
              } else {
                $.messager.show({// show error message
                  title: 'Error',
                  msg: result.msg
                });
              }
              }, 'json');
            }
          });
        }
      }
      
      function batchEdit(){
        var row = $('#dgBatch').datagrid('getSelected');
        if (row){
          $('#dlgBatch').dialog('open').dialog('setTitle','Edit Batch');
          $('#fmBatch').form('load',row);
          url = 'batchEdit.php?id='+row.idBatch;
        }
      }
      
      function batchSave(){
        $('#fmBatch').form('submit',{
          url: url,
          onSubmit: function(){
            return $(this).form('validate');
          },
          success: function(result){
            var result = eval('('+result+')');
            if (result.success){
              $('#dlgBatch').dialog('close');		// close the dialog
              $('#dgBatch').datagrid('reload');	// reload the user data
            } else {
              $.messager.show({
                title: 'Error',
                msg: result.msg
              });
            }
          }
        });
      }
    </script>

  </head>
  <body>
    <div class="easyui-tabs" id="tabs">         
      <div Title= "Home">
       <div class="demo-container">
          <div id="current_graph" class="demo-placeholder"></div>
          <div id="overview_graph" class="overview-placeholder"></div>
        </div>

        <table id="dgStatus" class="easyui-datagrid" style="width:750px" 
          toolbar="#toolbarStatus" fitColumns="false" >
          <thead>
            <tr>
              <th field="idStatus" hidden="true">ID</th>
              <th field="idBatch" editor="{type:'numberbox'}">Batch</th>
              <th field="Temp Setpoint" editor="{type:'numberbox'}">Temp</th>
              <th field="Humidity Setpoint" editor="{type:'numberbox'}">Humidity</th>
              <th field="Store Readings" editor="{type:'checkbox',options:{on: '1',off:'0'}}">Store Readings</th>
              <th field="PID H Kp" editor="{type:'numberbox'}">H-Kp</th>
              <th field="PID H Ki" editor="{type:'numberbox'}">H-Kp</th>
              <th field="PID H Kd" editor="{type:'numberbox'}">H-Kp</th>
              <th field="PID T Kp" editor="{type:'numberbox'}">T-Kp</th>
              <th field="PID T Ki" editor="{type:'numberbox'}">T-Ki</th>
              <th field="PID T Kd" editor="{type:'numberbox'}">T-Kd</th>
              <th field="Sensor Read Timeout" editor="{type:'numberbox'}">Sensor Read<br>Timeout</th>
              <th field="Window Size" editor="{type:'numberbox'}">Window Size</th>
              <th field="Sample Delay" editor="{type:'numberbox'}">Sample Delay</th>
            </tr>
          </thead>
        </table>
        <div id="toolbarStatus">
          <a href="#" class="easyui-linkbutton" iconCls="icon-save" plain="true" onclick="javascript:$('#dgStatus').edatagrid('saveRow')">Save</a>
          <a href="#" class="easyui-linkbutton" iconCls="icon-undo" plain="true" onclick="javascript:$('#dgStatus').edatagrid('cancelRow')">Cancel</a>
        </div>	
      </div>

      <div title="Admin">
          <p> Batches
          <div id="batch_output"></div>
          <table id="dgBatch" class="easyui-datagrid" style="width:500px"
            url="batchGet.php"
            toolbar="#toolbarBatch" pagination="true"
            rownumbers="true" fitColumns="true" singleSelect="true">
            <thead>
              <tr>
                <th field="idBatch" width="15" hidden="true">ID</th>
                <th field="Name" width="50">Name</th>
              </tr>            
            </thead>
          </table>      
          
          <div id="toolbarBatch">
              <a href="#" class="easyui-linkbutton" iconCls="icon-add" plain="true" onclick="batchCreate()">New</a>
              <a href="#" class="easyui-linkbutton" iconCls="icon-edit" plain="true" onclick="batchEdit()">Edit</a>
              <a href="#" class="easyui-linkbutton" iconCls="icon-remove" plain="true" onclick="batchRemove()">Delete</a>
          </div>

          <div id="dlgBatch" class="easyui-dialog" style="width:400px;height:280px;padding:10px 20px"
              closed="true" buttons="#dlgBatch-buttons">
              <div class="ftitle">Batch Information</div>
              <form id="fmBatch" method="post" novalidate>
                <div class="fitem">
                  <label>Name:</label>
                  <input name="Name" class="easyui-validatebox" required="true">
                </div>
              </form>
          </div>
        </p>
        
        <div id="dlgBatch-buttons">
            <a href="#" class="easyui-linkbutton" iconCls="icon-ok" onclick="batchSave()">Save</a>
            <a href="#" class="easyui-linkbutton" iconCls="icon-cancel" onclick="javascript:$('#dlgBatch').dialog('close')">Cancel</a>
        </div>
        
        <p> Items
        <table id="dgItem" class="easyui-datagrid" style="width:700px;height:250px"
                toolbar="#toolbarItem" pagination="true" idField="idMeat"
                rownumbers="true" fitColumns="true" singleSelect="true">
            <thead>
                <tr>
                    <th field="idMeat" width="15" hidden="true">ID</th>
                    <th field="idBatch" width="15" hidden="true">Batch</th>
                    <th field="Name" width="50" editor="{type:'validatebox',options:{required:true}}">Name</th>
                    <th field="Recipe" width="50" editor='text'>Recipe</th>
                    <th field="Culture" width="50" editor='text'>Culture</th>
                    <th field="Mold" width="50" editor='text'>Mold</th>
                </tr>
            </thead>
        </table>
        <div id="toolbarItem">
          <a href="#" class="easyui-linkbutton" iconCls="icon-add" plain="true" onclick="javascript:$('#dgItem').edatagrid('addRow',{row:{idBatch:currentBatch}})">New</a>
          <a href="#" class="easyui-linkbutton" iconCls="icon-remove" plain="true" onclick="javascript:$('#dgItem').edatagrid('destroyRow')">Delete</a>
          <a href="#" class="easyui-linkbutton" iconCls="icon-save" plain="true" onclick="javascript:$('#dgItem').edatagrid('saveRow')">Save</a>
          <a href="#" class="easyui-linkbutton" iconCls="icon-undo" plain="true" onclick="javascript:$('#dgItem').edatagrid('cancelRow')">Cancel</a>
        </div>	
      </div>
    </div>
  </body>
</html>