<?php
include_once 'insert_mysql.php';
include_once 'select_mysql.php';
include_once 'home.php';
include_once 'batch.php';
?>
<html>
  <head>
   	<link rel="stylesheet" type="text/css" href="http://www.jeasyui.com/easyui/themes/default/easyui.css">
	<link rel="stylesheet" type="text/css" href="http://www.jeasyui.com/easyui/themes/icon.css">
	<link rel="stylesheet" type="text/css" href="http://www.jeasyui.com/easyui/demo/demo.css">
    <link rel='stylesheet' type='text/css' href='styles.css'>
    <link rel="stylesheet" href="http://code.jquery.com/ui/1.10.2/themes/smoothness/jquery-ui.css" />
    <script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.0/jquery.min.js"></script>
    <script src="http://code.jquery.com/ui/1.10.2/jquery-ui.js"></script>
    <script src="http://www.flotcharts.org/flot/jquery.flot.js"></script>
    <script src="http://www.flotcharts.org/flot/jquery.flot.crosshair.js"></script>
    <script src="http://www.flotcharts.org/flot/jquery.flot.time.js"></script>
    <script src="http://www.flotcharts.org/flot/jquery.flot.selection.js"></script>
    <script src="select_batch.js"></script>


	<script type="text/javascript" src="http://www.jeasyui.com/easyui/jquery.easyui.min.js"></script>
    
    <script type="text/javascript">    
      var overview, chart, options, overviewoptions;
      var currentBatch;
      var url;     
      
      $(document).ready(function() {
        // Tabs
        $("#tabs").tabs({
          beforeLoad: selectBatchInit()
        }); 
        
        $('#dgBatch').datagrid({
          onClickRow:function(rowIndex,row){
            currentBatch = row.idBatch;
            $('#dgItem').datagrid({
              url:'itemGet.php?idBatch='+row.idBatch 
            });
            $('#dgItem').datagrid('reload');	// reload the user data
          }
        });       
      });     

      function itemNew(){
        $('#dlgItem').dialog('open').dialog('setTitle','New Item');
        $('#fmItem').form('clear');
        $('#fmItem').form('load',{
            idBatch:currentBatch
        });
        url = 'itemNew.php';
      }
      
      function itemEdit(){
        var row = $('#dgItem').datagrid('getSelected');
        if (row){
          $('#dlgItem').dialog('open').dialog('setTitle','Edit Item');
          $('#fmItem').form('load',row);
          url = 'itemEdit.php?id='+row.idMeat;
        }
      }
      
      function itemSave(){
        $('#fmItem').form('submit',{
          url: url,
          onSubmit: function(){
            return $(this).form('validate');
          },
          success: function(result){
            var result = eval('('+result+')');
            if (result.success){
              $('#dlgItem').dialog('close');		// close the dialog
              $('#dgItem').datagrid('reload');	// reload the user data
            } else {
              $.messager.show({
                title: 'Error',
                msg: result.msg
              });
            }
          }
        });
      }
      function itemRemove(){
        var row = $('#dgItem').datagrid('getSelected');
        if (row){
          $.messager.confirm('Confirm','Are you sure you want to remove this user?',function(r){
            if (r){
              $.post('itemRemove.php', {id: row.idMeat}, function(result) {
              if (result.success) {
                $('#dgItem').datagrid('reload');	// reload the user data
              } else {
                $.messager.show({// show error message
                  title: 'Error',
                  msg: result.msg
                });
              }
              }, 'json');
            }
          });
        }
      }
      
      function itemGet() {
        currentBatch = $('select#selectBatchName').val();
        $('#dgItem').datagrid({
          url:'itemGet.php?idBatch='+currentBatch 
        });
        $('#dgItem').datagrid('reload');	// reload the user data
      }
      
      function batchCreate() {
        $('#dlgBatch').dialog('open').dialog('setTitle','New Batch');
        $('#fmItem').form('clear');

        url = 'batchNew.php';
      }
      
      function batchRemove(){
        var row = $('#dgBatch').datagrid('getSelected');
        if (row){
          $.messager.confirm('Confirm','Are you sure you want to remove this user?',function(r){
            if (r){
              $.post('batchRemove.php', {id: row.idBatch}, function(result) {
              if (result.success) {
                $('#dgBatch').datagrid('reload');	// reload the user data
              } else {
                $.messager.show({// show error message
                  title: 'Error',
                  msg: result.msg
                });
              }
              }, 'json');
            }
          });
        }
      }
      
      function batchEdit(){
        var row = $('#dgBatch').datagrid('getSelected');
        if (row){
          $('#dlgBatch').dialog('open').dialog('setTitle','Edit Batch');
          $('#fmBatch').form('load',row);
          url = 'batchEdit.php?id='+row.idBatch;
        }
      }
      
      function batchSave(){
        $('#fmBatch').form('submit',{
          url: url,
          onSubmit: function(){
            return $(this).form('validate');
          },
          success: function(result){
            var result = eval('('+result+')');
            if (result.success){
              $('#dlgBatch').dialog('close');		// close the dialog
              $('#dgBatch').datagrid('reload');	// reload the user data
            } else {
              $.messager.show({
                title: 'Error',
                msg: result.msg
              });
            }
          }
        });
      }
    </script>

  </head>
  <body>
    <div class="easyui-tabs" id="tabs">         
      <div Title= "Home">
        <div class="demo-container">
          <div id="current_graph" class="demo-placeholder"></div>
          <div id="overview_graph" class="overview-placeholder"></div>
        </div>
        <?php
        $home = home();
        echo $home;
        $start = 1365388734;
        $stop = 1365506734;
        $type = 'Internal Temperature';
        $dataset = getReadings($start, $stop, $type);
        $type = 'Internal Humidity';
        $dataset1 = getReadings($start, $stop, $type);
        ?>
      </div>

      <div title="Admin">
          <p> Batches
          <div id="batch_output"></div>
          <table id="dgBatch" class="easyui-datagrid" style="width:500px"
            url="batchGet.php"
            toolbar="#toolbarBatch" pagination="true"
            rownumbers="true" fitColumns="true" singleSelect="true">
            <thead>
              <tr>
                <th field="idBatch" width="15" hidden="true">ID</th>
                <th field="Name" width="50">Name</th>
              </tr>            
            </thead>
          </table>      
          
          <div id="toolbarBatch">
              <a href="#" class="easyui-linkbutton" iconCls="icon-add" plain="true" onclick="batchCreate()">New</a>
              <a href="#" class="easyui-linkbutton" iconCls="icon-edit" plain="true" onclick="batchEdit()">Edit</a>
              <a href="#" class="easyui-linkbutton" iconCls="icon-remove" plain="true" onclick="batchRemove()">Delete</a>
          </div>

          <div id="dlgBatch" class="easyui-dialog" style="width:400px;height:280px;padding:10px 20px"
              closed="true" buttons="#dlgBatch-buttons">
              <div class="ftitle">Batch Information</div>
              <form id="fmBatch" method="post" novalidate>
                <div class="fitem">
                  <label>Name:</label>
                  <input name="Name" class="easyui-validatebox" required="true">
                </div>
              </form>
          </div>
        </p>
        
        <div id="dlgBatch-buttons">
            <a href="#" class="easyui-linkbutton" iconCls="icon-ok" onclick="batchSave()">Save</a>
            <a href="#" class="easyui-linkbutton" iconCls="icon-cancel" onclick="javascript:$('#dlgBatch').dialog('close')">Cancel</a>
        </div>
        
        <p> Items
        <table id="dgItem" class="easyui-datagrid" style="width:700px;height:250px"
                toolbar="#toolbarItem" pagination="true" idField="idMeat"
                rownumbers="true" fitColumns="true" singleSelect="true">
            <thead>
                <tr>
                    <th field="idMeat" width="15" hidden="true">ID</th>
                    <th field="idBatch" width="15" hidden="true">Batch</th>
                    <th field="Name" width="50">Name</th>
                    <th field="Recipe" width="50">Recipe</th>
                    <th field="Culture" width="50">Culture</th>
                    <th field="Mold" width="50">Mold</th>
                </tr>
            </thead>
        </table>

        <div id="toolbarItem">
            <a href="#" class="easyui-linkbutton" iconCls="icon-add" plain="true" onclick="itemNew()">New</a>
            <a href="#" class="easyui-linkbutton" iconCls="icon-edit" plain="true" onclick="itemEdit()">Edit</a>
            <a href="#" class="easyui-linkbutton" iconCls="icon-remove" plain="true" onclick="itemRemove()">Delete</a>
        </div>

        <div id="dlgItem" class="easyui-dialog" style="width:400px;height:280px;padding:10px 20px"
                closed="true" buttons="#dlgItem-buttons">
            <div class="ftitle">Item Information</div>
            <form id="fmItem" method="post" novalidate>
              <div class="fitem">
                <label>Batch:</label>
                <input name="idBatch">
              </div>
              <div class="fitem">
                  <label>Name:</label>
                  <input name="Name" class="easyui-validatebox" required="true">
              </div>
              <div class="fitem">
                  <label>Recipe:</label>
                  <input name="Recipe">
              </div>
              <div class="fitem">
                  <label>Culture:</label>
                  <input name="Culture">
              </div>
              <div class="fitem">
                  <label>Mold:</label>
                  <input name="Mold">
              </div>
            </form>
        </div>
        <div id="dlgItem-buttons">
            <a href="#" class="easyui-linkbutton" iconCls="icon-ok" onclick="itemSave()">Save</a>
            <a href="#" class="easyui-linkbutton" iconCls="icon-cancel" onclick="javascript:$('#dlgItem').dialog('close')">Cancel</a>
        </div>
      </div>
    </div>
  </body>
</html>